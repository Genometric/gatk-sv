name: Test Action

on:
  push:
    branches:
      - main
      - VJalili-patch-31
    paths:
      - 'src/**'
      - 'dockerfiles/**'
      - 'scripts/docker/build_docker.py'
      - '.github/workflows/test_action.yml'
  pull_request:
    branches:
      - main
      - VJalili-patch-31
    paths:
      - 'src/**'
      - 'dockerfiles/**'
      - 'scripts/docker/build_docker.py'
      - '.github/workflows/test_action.yml'

permissions:
  id-token: write
  contents: write

jobs:
  build_args_job:
    runs-on: ubuntu-latest
    environment: Tests
    name: TEST RUN
    env:
      GITHUB_CONTEXT: ${{ toJson(github) }}
    steps:
      - name: 'Az CLI login'
        uses: azure/login@v2
        with:
            client-id: ${{ secrets.AZURE_CLIENT_ID }}
            tenant-id: ${{ secrets.AZURE_TENANT_ID }}
            subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      #      - name: Azure CLI script
      #        uses: azure/cli@v2
      #        with:
      #          azcliversion: latest
      #          inlineScript: |
      #            az account show
      #            echo "Hello" > text.txt
      #            az storage blob upload --file text.txt --account-name "cromwell7379410456f0" --container-name "workflows" --auth-mode login
#     #
            
      - name: Hello world action step
        id: hello
        uses: Genometric/hello-world-javascript-action@v1.28
        with:
          azure-storage-account-name: 'cromwell7379410456f0'
          azure-storage-container-name: 'workflows'
          azure-storage-blob-name: 'new/trigger.json'
          workflow-path: "https://cromwell7379410456f0.blob.core.windows.net/tests-inputs/Aaa.wdl"
          workflow-inputs-path: "https://cromwell7379410456f0.blob.core.windows.net/tests-inputs/aaa_test_inputs.json"
          workflow-dependencies-path: "https://cromwell7379410456f0.blob.core.windows.net/tests-inputs/test_wdls.zip"
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"
